# Сервис для полуавтоматической разметки товаров для ООО "Просепт"
Хакатон декабрь 2023 г.
### Команда №14:
- Анастасия Крицкая - предобработка данных, тестирование моделей
- Олеся Круглякова - подбор способа валидации, тестирование моделей, отчётность, оформление
- Иван Прошин - тестирование моделей, оформление скрипта

### Задача проекта

Разработка решения, которое частично автоматизирует процесс сопоставления товаров. Основная идея - предлагать несколько товаров заказчика, которые с наибольшей вероятностью соответствуют размечаемому товару дилера.  Реализуется в виде онлайн сервиса, открываемого в веб-браузере.

### Задача ML-специалистов

Разработать рекомендательную модель, которая будет предлагать несколько наиболее вероятных вариантов названия товара у заказчика к названию товара, используемомому на сайте дилера. 

### Содержание репозитория с ML-решением
- [`prosept-hack-notebook.ipynb`](https://github.com/avkrickaya/Prosept_matching/blob/main/prosept-hack-notebook.ipynb) - Ноутбук с анализом, предобработкой данных, обучением модели, валидацией 
-  [`model.py`](https://github.com/avkrickaya/Prosept_matching/blob/main/model.py): скрипт прогнозирования `model.py`
-  [`requirements.txt`](https://github.com/avkrickaya/Prosept_matching/blob/main/requirements.txt) - список требуемых зависимостей
-  `marketing_product.csv`, `marketing_dealerprice.csv` - таблица продуктов заказчика, ттаблица спарсенных данных с сайтов дилеров



#### Стек технологий
`Python3` `Pandas` `Sklearn` `Numpy` `pymorphy2` `NLTK` `sentence_transformers`

#### Метрика качества
Для валидации используется метрика **accuracy@5** - рассчитывается как доля случаев, когда хотя бы одна из правильных меток присутствует в топ-5 предсказанных.

Далее будем уточнять метрику, скорее всего, будем предсказывать не определённое количество в топе, а товары выше определённого порога вероятности.

### Инструкция по запуску скрипта 

Клонировать репозиторий

```git clone git@github.com:avkrickaya/Prosept_matching.git```   

Установить виртуальное окружение

```python3 -m venv venv```

Запустить виртуальное окружение

```source venv/bin/activate```

Установить все зависимости

```pip install -r requirements.txt```

Запустить скрипт

```python model.py```

Скрипт сохранит локально файл в формате csv с записанными рекомендациями. Сейчас для демонстрации в скрипте стоит ограничение - передаётся только 100 первых записей из датасета со спарсенными данными.

## Описание ML-решения 
Для решения задачи заказчика используется метод ранжирования, алгоритм подбирает 5 наиболее вероятных названий.   
Выбран подход, в котором создаются эмбединги названий и далее подбор проходит с помощью косинусной близости.   

На текущей стадии работы для метчинга мы использовали только названия продуктов, остальные признаки планируем задействоваь в следующих экспериментах. Названия предварительно очищены от части символов, приведены к нижнему регисту, добавлены нехватающие пробелы.

Протестировано несколько моделей для создания векторного представления.    

- В качестве  baseline выбрано решение: `TfidfVectorizer + косинусное сходство из sklearn`.

- Лучший результат показала предобученная модель `LaBSE` из `sentence_transformers` + косинусное сходство `util.pytorch_cos_sim` с accuracy@5 = 91% на всей доступной выборке.




## Взаимодействие 
Взаимодействие с ML- модулем в приложении будет организовано по схеме  Batch deployment:    
Предсказания модели рассчитываются с  заданной периодичностью или при внесении изменений в базу данных. Мы предполагаем, что запуск будет осуществляться  ежедневно ночью после окончания парсинга. Результат сохраняется в базу данных и предоставляется по запросу пользователя:
![image](https://github.com/avkrickaya/Prosept_matching/assets/139965241/54661a6b-f4c9-4133-9224-dd1c981fb5d4)


 Часть | Действие
----------|----
Backend | Инициируется запуск ML-модуля по расписанию или  после окончания  парсинга|
ML + Backend | ML-модуль взаимодействует с бэкендом для получения данных таблиц marketing_product.csv и 'marketing_dealer.csv' из базы данных |
ML | ML-модуль проводит предобработку данных из таблиц и генерирует для каждой записи 5 рекомендованных названий продуктов, создаёт датасет csv-формата с результатами  |
Backend | Сгенерированные данные сохраняются в базе данных |
Frontend | Пользователь кликает на название продукта с целью сделать разметку, данные о рекомендациях приходят из базы данных|
